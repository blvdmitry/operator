# Installation

BUI React is a React implementation of BUI components.
Package can be added to your project with npm or yarn.

```
# yarn
yarn add @bookingcom/bui-react @bookingcom/bui-assets-react

# npm
npm install @bookingcom/bui-react @bookingcom/bui-assets-react
```

It requires React and React DOM packages to be already installed in your project.
BUI React is distributed within our internal Artifactory npm registry, so if you get any timeout errors during the installation - check your proxy settings and [.npmrc](https://gitlab.booking.com/design-systems/bui/bui-web/-/blob/bui@current/.npmrc).

## Setup build process

BUI is using PostCSS and CSS Modules to provide you with dynamic theming based on CSS custom properties and help you avoid styling conflicts.
That's one of the reasons why we keep css imports in the components js code, including mixins and custom media queries.
To get this working on the product side â€“ you have to import our postcss config and enable both features in your bundler (if that's not happening automatically.)

**Webpack example:**

Add postcss.config.js to your project:

```js
// postcss.config.js
const postcss = require("@bookingcom/bui-react/postcss");
module.exports = postcss.modern();
```

Add loaders to the webpack config:

```js
// webpack.config.js
module.exports = {
  module: {
    rules: [
      {
        test: /\.css$/,
        use: ["style-loader", "css-loader", "postcss-loader"],
      },
    ],
  },
};
```

**Next.js example**

<details>
<summary>Click to expand the instructions for Next.js</summary>

If your [Next.js](https://nextjs.org/) version is >= 13.1 then you should update the _next.config.js_ file in order to configure `transpilePackages` and `webpack` as the following:

```js
/** @type {import("next").NextConfig} */

module.exports = {
  reactStrictMode: true, // and any other configuration you had in your original next.config.js file

  transpilePackages: ["@bookingcom/bui-assets-react", "@bookingcom/bui-react"],
  webpack: (config, { isServer }) => {
    if (isServer) {
      config.resolve.mainFields = ["module", "main"];
    }

    const rule = config.module.rules.find((rule) => "oneOf" in rule);
    if (rule && rule.oneOf) {
      rule.oneOf.forEach((moduleLoader) => {
        Array.isArray(moduleLoader.use) &&
          moduleLoader.use.forEach((i) => {
            if (i.loader && i.loader.includes("css-loader")) {
              i.options = {
                ...i.options,
                modules: {
                  ...i.options.modules,
                  mode: "local",
                },
              };
            }
          });
      });
    }

    return config;
  },
};
```

#### In case you have an older version of Next.js (< 13.1):

Old versions of [Next.js](https://nextjs.org/) does not have builtin  Module Transpilation, but you can still configure the build by using the (deprecated) [next-transpile-modules](https://www.npmjs.com/package/next-transpile-modules) plugin:

1. Install _next-transpile-modules_ by running `yarn add next-transpile-modules`
2. Update the _next.config.js_ to configure webpack as the following: https://paste.booking.com/8x1p47

</details>

**Notes:**

- Since we don't define a theme on the BUI level, postcss should be compiling the code in node_modules as well, so make sure to not exclude it in the bundler
- This example is targeting browsers including IE11 and compiling all the css variables.
  If your product supports only modern browsers, you can use `.modern()` config instead.
  Check the Using foundations document for more information.

## Importing the library

To start using the library you need to import components from `@bookingcom/bui-react` package, including BUIProvider component.
BUIProvider should be used as a wrapper around your application to provide global data to all components, like the current theme or viewport size.

```jsx
import { BUIProvider, Button } from "@bookingcom/bui-react";
import legacyTheme from "@bookingcom/bui-react/themes/legacy";

const App = () => (
  <BUIProvider theme={legacyTheme}>
    <Button text="Click me" />
  </BUIProvider>
);
```

If you're building a component library that is going to be used in BUI React project - you don't need to wrap your components with the provider as it will cause duplicated context and css imports.

For more information about using `BUIProvider` check its documentation page.

## Server side rendering

Our components support SSR out-of-the-box but there are a couple of utilities that are relying on DOM manipulations.
In case you want to use those on the server-side as well - we provide fallback for the initial render.

**Runtime theming**: Our theming works through applying classNames to elements and the top-level theme applies its className to the body element instead.
Since there is no DOM access to the body element on server - you'll have to apply your default theme className manually and will be hydrated on the client afterwards.
Every theme has `lightAttributes` and `darkAttributes` objects to use for SSR to achieve this.

```jsx
import legacyTheme from "@bookingcom/bui-react/themes/legacy";

const Document = () => {
  return (
    <html>
      <body {...legacyTheme.lightAttributes}></body>
    </html>
  );
};
```

**RTL**: RTL is handled through the `dir` attribute on the html element.
While for the client-side rendering you can provide `defaultRTL` to `BUIProvider`, we won't have access to the body element during SSR.
Therefore, you have to define your default value for the `dir` attribute manually and BUIProvider will pick it up from there on the client:

```jsx
const Document = () => {
  return <html dire="rtl"></html>;
};
```

**Viewport detection**: We have a hook to detect the current viewport which will work only on the client-side.
By default, it uses `small` screen as a fallback, and it will cause layout jumps on the first client-side render if opened with another screen size.
To avoid these layout issues - you can provide the `defaultViewport` value to the BUIProvider during SSR.
Keep in mind, that on server you don't exactly know the screen size of the device, but you can use User agent detection to define the `defaultViewport` value.

## Library entry points

You can find a lot of separate modules in the library which are not merged for tree-shaking purposes.
Most of them are used as library private modules and their location and exported functionality may change in the future.

However, there are entry points available that are exposed as the library public API and are guaranteed to stay the same for the future patch and minor releases:

**Library components and utilities:** `@bookingcom/bui-react`

**Themes:** `@bookingcom/bui-react/themes/`

## Using for a product pattern library

If you're using BUI React for building libraries that are going to be used inside another BUI React v6+ project,
you can drop some parts mentioned in this guideline.

1. You don't need to wrap your component with BUIProvider.
   BUI context will be inherited from the product BUIProvider and will allow you to share the data between your components and the product context state.
   For instance, that way your component will inherit theme and themeMode used on the product.

2. You don't need to compile your css with our postCSS config, unless you're adding any additional plugins on top.
   There is a guaranteed postCSS compilation step on the product that will take care of the compilation, using the config option they need in the product.
